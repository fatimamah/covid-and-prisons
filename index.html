<!DOCTYPE html>
<meta charset="UTF-8">
<title>Project 2</title>
<script src="https://d3js.org/d3.v6.min.js"></script>
<script src="https://d3js.org/topojson.v3.min.js"></script>


<body>
  <h1> Project 2</h1>
  <script>

    const requestData = async function () {

      var prison_data = await d3.json("covid_prison_cases.json", d3.autoType);
      var prison_pops =  await d3.json("prison_populations.json", d3.autoType);

      prison_pops.forEach((d, i) => {
        //console.log(d.march_pop);
      });


      // console.log(prison_data.length);
      // console.log(prison_data);
      // console.log(typeof (prison_data))


      // prison_data = prison_data.filter((d) => { return (d['total_prisoner_case']) != ""; })
      // console.log(prison_data.length);

      const formatMonthYear = d3.timeFormat('%b-%Y');


      prison_data.forEach((d, i) => {
        d["as_of_date"] = new Date(d["as_of_date"]);
        d["month_year"] = formatMonthYear(d["as_of_date"]);
        d["year"] = d["as_of_date"].getFullYear();

      });

      prison_data = prison_data.filter((d) => { return d['total_prisoner_cases'] != null && d["as_of_date"].getFullYear()!=2021 ; })


      console.log(prison_data);

      // not totalled
      // var groupByMonth = d3.groups(prison_data, d => d.month_year, d => d.name)
      // console.log(groupByMonth)


      //totals
      var summed = d3.rollups(prison_data, v => d3.sum(v, d => d.total_prisoner_cases), d => d.month_year, d => d.name)

      console.log(summed)

      summed.forEach((d, i) => {
        console.log(d);

      });



      // const groupBy = (array, key) => {
      //   return array.reduce((result, currentValue) => {
      //     (result[currentValue[key]] = result[currentValue[key]] || []).push(
      //       currentValue
      //     );
      //     return result;
      //   }, {});
      // };

      // var sorted_data = groupBy(prison_data, "name");




      // console.log(sorted_data);



      //Date d = new Date(2011,11,30);




    }

    requestData();

  </script>


</body>


</html>
